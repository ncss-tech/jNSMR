<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Applying Newhall to PRISM 30-year Normals for Continental United States • jNSMR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Applying Newhall to PRISM 30-year Normals for Continental United States">
<meta property="og:description" content="jNSMR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jNSMR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/legacy-newhall161.html">Using Legacy Newhall v1.6.1 Routines</a>
    </li>
    <li>
      <a href="../articles/newhall-prism.html">Applying Newhall to PRISM 30-year Normals for Continental United States</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ncss-tech/jNSMR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Applying Newhall to PRISM 30-year Normals for
Continental United States</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ncss-tech/jNSMR/blob/HEAD/vignettes/newhall-prism.Rmd" class="external-link"><code>vignettes/newhall-prism.Rmd</code></a></small>
      <div class="hidden name"><code>newhall-prism.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ncss-tech.github.io/jNSMR">jNSMR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; jNSMR (0.3.1) -- R interface to the classic Newhall Simulation Model</span></span>
<span><span class="co">#&gt; Added JAR file (newhall-1.6.5.jar) to Java class path.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.71</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"prism_issr800_sample.tif"</span>, package <span class="op">=</span> <span class="st">"jNSMR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># elevation is not currently used by the model directly</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-simulations">Run simulations<a class="anchor" aria-label="anchor" href="#run-simulations"></a>
</h2>
<p><code><a href="../reference/newhall_batch.html">newhall_batch()</a></code> allows us to provide data in
<em>SpatRaster</em> format, and return gridded model results.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run simulations</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newhall_batch.html">newhall_batch</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co">## full resolution</span></span>
<span><span class="co">#&gt; newhall_batch: ran n=18790 simulations in 18 secs</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>Several categorical quantities are returned related to temperature
and moisture regimes, as are a variety of numerical quantities relevant
to taxonomic limits and regime criteria.</p>
<div class="section level3">
<h3 id="temperature-regimes">Temperature Regimes<a class="anchor" aria-label="anchor" href="#temperature-regimes"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">temperatureRegime</span><span class="op">)</span></span></code></pre></div>
<p><img src="newhall-prism_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="moisture-regimes">Moisture Regimes<a class="anchor" aria-label="anchor" href="#moisture-regimes"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">moistureRegime</span><span class="op">)</span></span></code></pre></div>
<p><img src="newhall-prism_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
<div class="section level4">
<h4 id="moisture-regime-subdivision-1">Moisture Regime Subdivision 1<a class="anchor" aria-label="anchor" href="#moisture-regime-subdivision-1"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">regimeSubdivision1</span><span class="op">)</span></span></code></pre></div>
<p><img src="newhall-prism_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
</div>
<div class="section level4">
<h4 id="moisture-regime-subdivision-2">Moisture Regime Subdivision 2<a class="anchor" aria-label="anchor" href="#moisture-regime-subdivision-2"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">regimeSubdivision2</span><span class="op">)</span></span></code></pre></div>
<p><img src="newhall-prism_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
</div>
<div class="section level4">
<h4 id="taxonomic-quantities">Taxonomic Quantities<a class="anchor" aria-label="anchor" href="#taxonomic-quantities"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/panel.html" class="external-link">panel</a></span><span class="op">(</span><span class="va">y</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dryDaysAfterSummerSolstice"</span>, <span class="st">"numConsecutiveDaysMoistInSomePartsOver8C"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,</span>
<span>     cex.main <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></span></code></pre></div>
<p><img src="newhall-prism_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
</div>
</div>
<div class="section level3">
<h3 id="prism-data-for-custom-extent">PRISM Data for Custom Extent<a class="anchor" aria-label="anchor" href="#prism-data-for-custom-extent"></a>
</h3>
<p>The above sample dataset can be easily re-created for arbitrary
extents.</p>
<p>First, run the following commands to cache United States (lower 48)
PRISM and soil water storage capacity data at 800 meter resolution. In
the future there will be options for downloading Alaska, Pacific
Islands, Puerto Rico, or any other PRISM data sets.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/newhall_prism.html">newhall_prism_cache</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/newhall_issr800.html">newhall_issr800_cache</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>After the above two data sets have been downloaded, combine them and
add any other required fields and crop to an extent of interest.</p>
<p>For example, here we use a larger extent aggregated to 8000m
resolution to depict a broad transition between the “mesic” and
“thermic” temperature regimes.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/newhall_prism.html">newhall_prism_rast</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/newhall_issr800.html">newhall_issr800_rast</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">conus</span><span class="op">$</span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># elevation is not currently used by the model directly</span></span>
<span><span class="va">my_extent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">conus</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="op">-</span><span class="fl">91</span>, <span class="op">-</span><span class="fl">88</span>, <span class="fl">37.5</span>, <span class="fl">41.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## the above operation can also be achieved with newhall_*_subset() methods</span></span>
<span><span class="co"># my_extent &lt;- newhall_prism_subset(ext(-91, -88, 37.5, 41.5))</span></span>
<span><span class="co"># my_extent$awc &lt;- newhall_issr800_subset(ext(-91, -88, 37.5, 41.5))</span></span>
<span><span class="co"># my_extent$elev &lt;- 0</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newhall_batch.html">newhall_batch</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">my_extent</span>, <span class="fl">10</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">numConsecutiveDaysMoistInSomePartsOver8C</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"numConsecutiveDaysMoistInSomePartsOver8C"</span>,</span>
<span>     cex.main <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">temperatureRegime</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"temperatureRegime"</span>,</span>
<span>     cex.main <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p>By default the PRISM 800m grid template is used
(<code><a href="../reference/newhall_prism.html">newhall_nad83_template()</a></code>) as a consistent basis for the
ISSR800 data. You can specify alternate templates using the
<code>template</code> argument to the <code>newhall_*_subset()</code>
methods.</p>
</div>
<div class="section level3">
<h3 id="other-data-sources">Other Data Sources<a class="anchor" aria-label="anchor" href="#other-data-sources"></a>
</h3>
<p>In the future there may vignettes created for DAYMET data. In the
meantime, see the <code><a href="../reference/newhall_daymet.html">newhall_daymet_subset()</a></code> function.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrew G. Brown.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
